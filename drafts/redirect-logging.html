
<!DOCTYPE html>
<html lang="english">
<head>
  <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,400italic' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" type="text/css" href="https://johnpaton.net/theme/stylesheet/style.min.css">

  <link rel="stylesheet" type="text/css" href="https://johnpaton.net/theme/pygments/monokai.min.css">
  <link rel="stylesheet" type="text/css" href="https://johnpaton.net/theme/font-awesome/css/font-awesome.min.css">

    <link href="https://johnpaton.net//styles/custom.css" rel="stylesheet">

    <link href="https://johnpaton.net/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="John Paton Atom">

    <link href="https://johnpaton.net/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="John Paton RSS">

    <link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/images/favicon.ico" type="image/x-icon">

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="" />

    <!-- Chrome, Firefox OS and Opera -->
    <meta name="theme-color" content="#3aa500">
    <!-- Windows Phone -->
    <meta name="msapplication-navbutton-color" content="#3aa500">
    <!-- iOS Safari -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Microsoft EDGE -->
    <meta name="msapplication-TileColor" content="#3aa500">

<meta name="author" content="John Paton" />
<meta name="description" content="" />
<meta name="keywords" content="python">

<meta property="og:site_name" content="John Paton"/>
<meta property="og:title" content="Redirect Standard Out to Python&#39;s logging module with contextlib"/>
<meta property="og:description" content=""/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="https://johnpaton.net/drafts/redirect-logging.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2019-05-20 17:00:00-01:00"/>
<!--<meta property="article:modified_time" content=""/> -->
<meta property="article:author" content="https://johnpaton.net/author/john-paton.html">
<meta property="article:section" content="posts"/>
<meta property="article:tag" content="python"/>
<meta property="og:image" content="https://johnpaton.net/">

  <title>John Paton &ndash; Redirect Standard Out to Python&#39;s logging module with contextlib</title>

</head>
<body>
  <aside>
    <div>
      <a href="https://johnpaton.net">
        <img src="/images/headshot.png" alt="John Paton" title="John Paton">
      </a>
      <h1><a href="https://johnpaton.net/about">John Paton</a></h1>

<p><b style="color:#3aa500;margin-right:2px">/</b>data<b style="color:#3aa500;margin-right:2px;margin-left:2px">/</b>scientist</p>
      <nav>
        <ul class="list">

          <li><a href="/">blog home</a></li>
          <li><a href="/tags">tags</a></li>
          <li><a href="/about">about me</a></li>
          <li><a href="/writing-talks">writing&nbsp;&&nbsp;talks</a></li>
        </ul>
      </nav>

      <ul class="social">
        <li><a class="sc-github" href="http://www.github.com/johnpaton" target="_blank"><i class="fa fa-github"></i></a></li>
        <li><a class="sc-twitter" href="http://www.twitter.com/jd_paton" target="_blank"><i class="fa fa-twitter"></i></a></li>
        <li><a class="sc-linkedin" href="http://linkedin.com/in/john-paton" target="_blank"><i class="fa fa-linkedin"></i></a></li>
        <li><a class="sc-file-pdf-o" href="/static/johnpaton-cv.pdf" target="_blank"><i class="fa fa-file-pdf-o"></i></a></li>
        <li><a class="sc-rss" href="/feeds/all.atom.xml" target="_blank"><i class="fa fa-rss"></i></a></li>
      </ul>
    </div>


  </aside>
  <main>


<article class="single">
  <header>
      
    <h1 id="redirect-logging">Redirect Standard Out to Python's logging module with contextlib</h1>
    <p>
          Posted on Mon 20 May 2019


        &#8226; 3 min read
    </p>
  </header>


  <div>
    <p>Python's logging functionality is very nice once you get the hang of it, but many people (including library developers) either disagree or don't bother to use it. Instead, you often see things like this:</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">Epoch</span> <span class="mi">0</span>
<span class="n">Epoch</span> <span class="mi">1</span>
<span class="n">Epoch</span> <span class="mi">2</span>
<span class="o">...</span>
</pre></div>


<p>and onwards for 100 lines or whatever. </p>
<p>Writing status messages to standard out is <em>okay</em>, but if you want anything like consistent/parsable logs, log level handling, logging to multiple locations, etc. this can get a bit annoying. How can we redirect standard out to Python's logging system to get all these juicy benefits?</p>
<p>Another builtin module, <code>contextlib</code>, comes to our rescue.</p>
<h2>Aside: Context Managers</h2>
<p>Roughly speaking, a context manager in Python is an object that implements 2 methods: <code>__enter__</code> and <code>__exit__</code>. Usually you enter the context by using the <code>with</code> keyword, which triggers a call to <code>__enter__</code>. You execure some code in an indented block, and (roughly speaking) when you exit the block, the <code>__exit__</code> method is called. The context manager interface is what makes these two pieces of code more or less equivalent:</p>
<div class="highlight"><pre><span></span><span class="n">h</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;file.txt&quot;</span><span class="p">)</span>
<span class="n">text</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">h</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>


<p>is basically the same as</p>
<div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;file.txt&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h</span><span class="p">:</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre></div>


<p>The file handle returned by <code>open</code> implements <code>__enter__</code> and <code>__exit__</code>, which is why it can be used in this way. The nice benefit here is that we never forget to close the file, as <code>__exit__</code> is called automagically at the end of the block.</p>
<h2>Redirecting <code>stdout</code></h2>
<p>So how does this help us? Well, <code>contextlib</code> (which is the library for htings related to context managers, in case you didn't catch that) has a very handy context manager called <code>redirect_stdout</code> (and also the matching <code>redirect_stdin</code>). We can use it to redirect text written to standard out to another file-like object. For example, to write to a file, we could do:</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">contextlib</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;output.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h</span><span class="p">,</span> <span class="n">contextlib</span><span class="o">.</span><span class="n">redirect_stdout</span><span class="p">(</span><span class="n">h</span><span class="p">):</span>
<span class="o">...</span>     <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Hello world!&quot;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span>
</pre></div>


<p>We don't see any output. If we now look at the newly-created <code>output.txt</code>, we will see</p>
<div class="highlight"><pre><span></span>$ cat output.txt
Hello world!
</pre></div>


<p>I realize that there are better ways of writing to a file in Python, but writing to a file isn't the point. The point is that any arbitrary code executed in the context block above would have its output redirected to the file, <em>without</em> having to modify its print statements, including library code that we can't easily modify. </p>
<p>Now, <code>redirect_stdout</code> requires a file-like object that it can <code>write</code> to, which is why we first had to <code>open</code> out output file above. However, Python's loggers are not file-like. I think you see where this is going.</p>
<h2>A file-like logger</h2>
<h2>Baby's first context manager</h2>
<p>What we can do is the following:</p>
<ul>
<li>Create a class that implements a subset of the file-like interface (in this case we only really need <code>write</code>)</li>
<li>Make our <code>write</code> pass messages to a logger</li>
<li>Also implement our own context manager interface, where we pass our <code>self</code> to <code>redirect_stdout</code> so that anything that gets written in our context actually is redirected to the logger</li>
<li>Clean everything up when we exit</li>
</ul>
<p>This sounds complicated, but it turns out actually to be quite easy. Here is a barebones implementation:</p>
<h2>Disclaimer</h2>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="https://johnpaton.net/tag/python.html">python</a>
    </p>
  </div>



    <div class="addthis_relatedposts_inline">


<!-- Disqus -->
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'johnpatonblog';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>
        Please enable JavaScript to view comments.

</noscript>
<!-- End Disqus -->
</article>

    <footer>
<p>&copy; John Paton 2017</p>
<p>    Powered by <a href="http://getpelican.com" target="_blank">Pelican</a> - Theme <a href="https://github.com/JohnPaton/flex-mod" target="_blank">modified</a> from <a href="http://alexandrevicenzi.com" target="_blank">Alexandre Vicenzi</a>'s <a href="https://github.com/alexandrevicenzi/flex" target="_blank">Flex</a>
</p>    </footer>
  </main>

<!-- Google Analytics -->
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-92349567-1', 'auto');
  ga('send', 'pageview');
</script>
<!-- End Google Analytics -->



<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " John Paton ",
  "url" : "https://johnpaton.net",
  "image": "/images/headshot.png",
  "description": "John's deep musings and cheap tricks for Python, data science, machine learning, and more."
}
</script>

</body>
</html>