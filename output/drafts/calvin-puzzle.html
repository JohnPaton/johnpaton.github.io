
<!DOCTYPE html>
<html lang="english">
<head>
  <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,400italic' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" type="text/css" href="https://johnpaton.net/theme/stylesheet/style.min.css">

  <link rel="stylesheet" type="text/css" href="https://johnpaton.net/theme/pygments/monokai.min.css">
  <link rel="stylesheet" type="text/css" href="https://johnpaton.net/theme/font-awesome/css/font-awesome.min.css">

    <link href="https://johnpaton.net//styles/custom.css" rel="stylesheet">

    <link href="https://johnpaton.net/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="John Paton Atom">

    <link href="https://johnpaton.net/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="John Paton RSS">

    <link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/images/favicon.ico" type="image/x-icon">

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="" />

    <!-- Chrome, Firefox OS and Opera -->
    <meta name="theme-color" content="#3aa500">
    <!-- Windows Phone -->
    <meta name="msapplication-navbutton-color" content="#3aa500">
    <!-- iOS Safari -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Microsoft EDGE -->
    <meta name="msapplication-TileColor" content="#3aa500">

<meta name="author" content="John Paton" />
<meta name="description" content="I found this puzzle the other day and couldn&#39;t get it out of my head, so I decided to write up a solution. Calvin has to cross several signals when he walks from his home to school. Each of these signals operate independently. They alternate every 80 seconds between green light and red light. At each signal, there is a counter display that tells him how long it will be before the current signal light changes. Calvin has a magic wand which lets him turn a signal from red to green instantaneously. However, this wand comes with limited battery life, so he can use it only for a specified number of times." />
<meta name="keywords" content="python, statistics, puzzles">

<meta property="og:site_name" content="John Paton"/>
<meta property="og:title" content="Getting Calvin home on time: a statistics puzzle"/>
<meta property="og:description" content="I found this puzzle the other day and couldn&#39;t get it out of my head, so I decided to write up a solution. Calvin has to cross several signals when he walks from his home to school. Each of these signals operate independently. They alternate every 80 seconds between green light and red light. At each signal, there is a counter display that tells him how long it will be before the current signal light changes. Calvin has a magic wand which lets him turn a signal from red to green instantaneously. However, this wand comes with limited battery life, so he can use it only for a specified number of times."/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="https://johnpaton.net/drafts/calvin-puzzle.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2017-08-09 17:00:00-01:00"/>
<!--<meta property="article:modified_time" content=""/> -->
<meta property="article:author" content="https://johnpaton.net/author/john-paton.html">
<meta property="article:section" content="posts"/>
<meta property="article:tag" content="python"/>
<meta property="article:tag" content="statistics"/>
<meta property="article:tag" content="puzzles"/>
<meta property="og:image" content="https://johnpaton.net//images/headshot_wide.jpg">

  <title>John Paton &ndash; Getting Calvin home on time: a statistics puzzle</title>

</head>
<body>
  <aside>
    <div>
      <a href="https://johnpaton.net">
        <img src="/images/headshot.png" alt="John Paton" title="John Paton">
      </a>
      <h1><a href="https://johnpaton.net/about">John Paton</a></h1>

<p>data scientist<b style="color:#3aa500;font-size:20px;word-spacing:0px"> | </b>consultant</p>
      <nav>
        <ul class="list">

          <li><a href="/">blog home</a></li>
          <li><a href="/tags">tags</a></li>
          <li><a href="/about">about me</a></li>
          <li><a href="/writing-talks">writing & talks</a></li>
        </ul>
      </nav>

      <ul class="social">
        <li><a class="sc-github" href="http://www.github.com/johnpaton" target="_blank"><i class="fa fa-github"></i></a></li>
        <li><a class="sc-twitter" href="http://www.twitter.com/jd_paton" target="_blank"><i class="fa fa-twitter"></i></a></li>
        <li><a class="sc-linkedin" href="http://linkedin.johnpaton.net" target="_blank"><i class="fa fa-linkedin"></i></a></li>
        <li><a class="sc-file-pdf-o" href="/static/johnpaton-cv.pdf" target="_blank"><i class="fa fa-file-pdf-o"></i></a></li>
        <li><a class="sc-rss" href="/feeds/all.atom.xml" target="_blank"><i class="fa fa-rss"></i></a></li>
      </ul>
    </div>


  </aside>
  <main>


<article class="single">
  <header>
      
    <h1 id="calvin-puzzle">Getting Calvin home on time: a statistics puzzle</h1>
    <p>
          Posted on Wed 09 August 2017


        &#8226; 10 min read
    </p>
  </header>


  <div>
    <p>I found this puzzle the other day and couldn't get it out of my head, so I decided to write up a solution.</p>
<blockquote>
<p>Calvin has to cross several signals when he walks from his home to school. Each of these signals operate independently. They alternate every 80 seconds between green light and red light. At each signal, there is a counter display that tells him how long it will be before the current signal light changes. Calvin has a magic wand which lets him turn a signal from red to green instantaneously. However, this wand comes with limited battery life, so he can use it only for a specified number of times.</p>
<p>a) If the total number of signals is 2 and Calvin can use his magic wand only once, then what is the expected waiting time at the signals when Calvin optimally walks from his home to school?</p>
<p>b) What if the number of signals is 3 and Calvin can use his magic wand only once?</p>
<p>c) Write a code that takes as inputs the number of signals and the number of times Calvin can use his magic wand, and outputs the expected waiting time</p>
</blockquote>
<p>Assuming that the lights are independent, the time until a light changes (displayed on the counter) when Calvin arrives is drawn from a uniform distribution between 0 and 80:</p>
<div class="math">$$ t_{\text{counter}} \sim \text{Unif}(0\ \text{s},80\ \text{s}).$$</div>
<p>So the average waiting time at each <em>red</em> light is 40 seconds. Since there is a 50% chance that the light is green, the expected waiting per light time is</p>
<div class="math">$$ \bar t_{\text{wait}} = P(\text{green}) \cdot \bar t_{\text{counter}} = \frac{1}{2} \cdot 40\ \text{s} = 20\ \text{s}. $$</div>
<p>Calvin wants to use his wand in order to minimize his waiting time.</p>
<h2>a) If the total number of signals is 2 and Calvin can use his magic wand only once, then what is the expected waiting time at the signals when Calvin optimally walks from his home to school?</h2>
<p>With two lights and one use of the magic wand, there are three scenarios that can arise:</p>
<ul>
<li>
<p>If the first light is green (50% chance), then Calvin will use his wand on the second light, with 0 waiting time.</p>
</li>
<li>
<p>If the first light is red (50% chance):</p>
<ul>
<li>He will use his wand if the time on the timer is higher than the expected wait for the second light (20 seconds, 75% chance). In this case the expected waiting time is the expected time for the second light: 20 seconds.</li>
<li>He will not use his wand if the time on the timer is less than 20 seconds (the mean time these cases is 10 seconds since they are uniformly distributed between 0 and 20, and the situation occurs with a 25% chance). In that case he will wait, and use his wand on the second light, for a total expected waiting time of 10 seconds.</li>
</ul>
</li>
</ul>
<p>His total expected waiting time is found by taking a sum of all the different situations weighted by their probability:</p>
<div class="math">$$ \bar t_{wait} = 0.5 \cdot 0\ \text{s} + 0.5\cdot(0.75 \cdot 20\ \text{s} + 0.25 \cdot 10\ \text{s}) = 8.75\ \text{s}$$</div>
<p>So Calvin's expected waiting time is <strong>8.75 seconds</strong>.</p>
<p>Let's confirm this by trying it... one billion times [<em>evil laugh</em>]:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="n">n_trials</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">1e9</span><span class="p">)</span>

<span class="c1"># initialize the trials</span>
<span class="n">wait_times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_trials</span><span class="p">)</span>

<span class="c1"># light waiting times: uniform 0-80 seconds, 50% chance of being green (0 wait time)</span>
<span class="n">t1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">80</span><span class="p">,</span> <span class="n">n_trials</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">n_trials</span><span class="p">)</span>
<span class="n">t2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">80</span><span class="p">,</span> <span class="n">n_trials</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">n_trials</span><span class="p">)</span>

<span class="n">wand1</span> <span class="o">=</span> <span class="p">(</span><span class="n">t1</span> <span class="o">&gt;=</span> <span class="mi">20</span><span class="p">)</span> <span class="c1"># trials where Calvin uses the wand on light 1</span>

<span class="c1"># wait at light 2 wherever he uses the wand at light 1</span>
<span class="n">wait_times</span><span class="p">[</span><span class="n">wand1</span><span class="p">]</span> <span class="o">=</span> <span class="n">t2</span><span class="p">[</span><span class="n">wand1</span><span class="p">]</span> 
<span class="c1"># wait at light 1 wherever he doesn&#39;t use the wand at light 1</span>
<span class="n">wait_times</span><span class="p">[</span><span class="o">~</span><span class="n">wand1</span><span class="p">]</span> <span class="o">=</span> <span class="n">t1</span><span class="p">[</span><span class="o">~</span><span class="n">wand1</span><span class="p">]</span>

<span class="k">print</span><span class="p">(</span><span class="s1">&#39;Calvin</span><span class="se">\&#39;</span><span class="s1">s mean waiting time in {:,} trials was {:.3f} seconds&#39;</span>\
      <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n_trials</span><span class="p">,</span> <span class="n">wait_times</span><span class="o">.</span><span class="n">mean</span><span class="p">()))</span>
</pre></div>


<div class="highlight"><pre><span></span>Calvin&#39;s mean waiting time in 1,000,000,000 trials was 8.750 seconds
</pre></div>


<p>Nice!</p>
<h2>b) What if the number of signals is 3 and Calvin can use his magic wand only once?</h2>
<p>Now we have three signals and one wand usage. Since we have one wand, we want to find some optimal cutoff value that lets us decide whether or not to use the wand at each light. We base this on whether or not we expect to see a light with a higher waiting time than the current counter during the rest of our walk home.</p>
<p>At the last light, the cutoff is zero. If we haven't used the wand yet, we will definitely use it if the light is not green, as there are no more chances left to use it.</p>
<p>We've already shown that the cutoff at the second-to-last light should be 20 seconds, as this situation is the same one as in part a) (assuming the wand hasn't been used yet). </p>
<p>What about at the first light? We want to know the expectation value of <em>the maximum of</em> the next two waiting times. </p>
<p>The probability that the counter displays a waiting time is less than some time <span class="math">\(t\)</span> is given by</p>
<div class="math">$$ \tilde{F}(t) = P(t_{\text{count}} \le t) = \frac{t}{80}. $$</div>
<p><span class="math">\(\tilde{F}(t)\)</span> here is the Cumulative Density Function (CDF) for our uniformly distributed counter time. </p>
<p>Now, there is a 50% chance that the light will be green, in which case our waiting time is zero, regardless of the value displayed on the counter. This means that the probability of the waiting time being less than or equal to zero is already <span class="math">\(1/2\)</span>, and it grows linearly to <span class="math">\(1\)</span> for a waiting time up to <span class="math">\(80\)</span> seconds. So including the chance of a green light, the CDF for our waiting time is</p>
<div class="math">$$ F(t) = P(t_{\text{wait}} \le t) = \frac{1}{2} + \frac{1}{2}\frac{t}{80} .$$</div>
<p>We are interested in the maximum expected waiting time for the last 2 lights in Calvin's journey, so that he knows what his cutoff should be at the first light. What is the relevant CDF? If the maximum of two random variables is less than a time <span class="math">\(t\)</span>, then each of the variables must be less than <span class="math">\(t\)</span> individually. Since we are assuming that the waiting times are independent, their probabilities factor, and we get the CDF</p>
<div class="math">$$ F_2(t_\max) = P(t_{\text{wait},1},t_{\text{wait},2} \le t_\max) = P(t_{\text{wait},1}\le t_\max)P(t_{\text{wait},2} \le t_\max) =  F(t_\max)^2. $$</div>
<p>Clearly this generalizes to <span class="math">\(n\)</span> remaining lights, so let's consider the more general case and then specify <span class="math">\(n=2\)</span> to get the cutoff we want. We have</p>
<div class="math">$$ F_n(t_\max) = F(t_\max)^n = \left( \frac{1}{2} + \frac{1}{2}\frac{t_\max}{80} \right)^n. $$</div>
<p>We are looking for the expected value of this maximum. The expectation can found directly from the CDF by</p>
<div class="math">$$ E_n = 80 - \int_0^{80}\!\! \text{d}t\ F_n(t) = 80 - \int_0^{80}\text{d}t \left( \frac{1}{2} + \frac{1}{2}\frac{t}{80} \right)^n$$</div>
<p>(this can be seen from integrating the normal definition, <span class="math">\(E = \int \text{d}x\ x\ \text{PDF}(x)\)</span>, by parts). To take the integral, we perform the substitution <span class="math">\(u = 1/2 + t/(2\cdot80)\)</span> and get</p>
<div class="math">\begin{align*}
\int_0^{80}\text{d}t \left( \frac{1}{2} + \frac{1}{2}\frac{t}{80} \right)^n &amp;= 80 \cdot 2 \int_{\frac{1}{2}}^1 \text{d}u\ u^n \\
&amp;= 80 \cdot 2 \left. \frac{u^{n+1}}{n+1} \right|_{\frac{1}{2}}^1\\
&amp;= 80 \cdot \frac{2}{n+1}\left(1-\frac{1}{2^{n+1}}\right).
\end{align*}</div>
<p>Inserting this result into our expression for the expected maximum, we get</p>
<div class="math">$$ E_n = 80 \cdot \left(1 - \frac{2}{n+1}\left(1-\frac{1}{2^{n+1}}\right)\right) = 80 \cdot \left(\frac{n}{n+1} - \frac{1}{n+1}\left(1-\frac{1}{2^{n+1}}\right)\right). $$</div>
<p>Interestingly, in the second form above, <span class="math">\(80\cdot n/(n+1)\)</span> is the expected maximum waiting time if we had to wait at every light, and the second term is a correction due to half of the lights being green. Again we can confirm our calculation by simulation:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;ggplot&#39;</span><span class="p">)</span>

<span class="c1"># simulate (up to) 25 lights</span>
<span class="n">n_lights</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">n_trials</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">1e7</span><span class="p">)</span>
<span class="n">counter_max</span> <span class="o">=</span> <span class="mi">80</span>

<span class="c1"># simulate the lights (one row per light, one column per trial)</span>
<span class="n">trials</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">counter_max</span><span class="p">,</span> <span class="p">(</span><span class="n">n_lights</span><span class="p">,</span> <span class="n">n_trials</span><span class="p">,))</span>\
            <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">n_lights</span><span class="p">,</span> <span class="n">n_trials</span><span class="p">,))</span>

<span class="c1"># get the max waiting times for each possible number of lights</span>
<span class="n">t_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">trials</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_lights</span><span class="p">):</span>
    <span class="n">t_max</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">trials</span><span class="p">[:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,:]</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># get the calculated expectation and simulated mean of the max waiting times</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">n_lights</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">wait_max_exp</span> <span class="o">=</span> <span class="n">counter_max</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">))))</span>
<span class="n">wait_max_sim</span> <span class="o">=</span> <span class="n">t_max</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># plot to compare</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">wait_max_exp</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">65</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;expectation&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">wait_max_sim</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">35</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s1">&#39;simulation ({:,} trials)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n_trials</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">n</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Number of lights&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Max waiting time (seconds)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">n_lights</span><span class="o">+</span><span class="mi">1</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">counter_max</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Maximum expected waiting time in sample of $n$ lights&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>


<p><img alt="png" src="/images/calvin_4_0.png"></p>
<p>So we have values to function as our cutoffs, based on how many lights are remaining in the journey. Specifically, the cutoff for the first of 3 lights is given by the maximum expected wait time for the remaining <span class="math">\(n=2\)</span> lights: </p>
<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="s1">&#39;Max expected waiting time for 2 remaining lights is {:.2f} seconds.&#39;</span>\
      <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">wait_max_exp</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</pre></div>


<div class="highlight"><pre><span></span>Max expected waiting time for 2 remaining lights is 33.33 seconds.
</pre></div>


<p>Calvin should use his wand if the first light is red and the counter is over 33.33 seconds. We can calculate his expected waiting time by using the result from a) and considering the possible scenarios:</p>
<ul>
<li>
<p>The first light is green (50% chance). In this case Calvin has two lights and one wand to go; this is the situation from a). In this scenario the expected waiting time is 8.75 seconds.</p>
</li>
<li>
<p>The first light is red (50% chance):</p>
<ul>
<li>
<p>The timer is over the cutoff ( <span class="math">\((80-33.33)/80 = 58\)</span>% chance for uniformly distributed time on the counter). In this case Calvin uses the wand, and with no wands left he expects to wait for 20 seconds per light for the remaining number of lights. There are two lights left, so the expected wait time in this case is 40 seconds.</p>
</li>
<li>
<p>The timer is under the cutoff (42% chance). In this case Calvin waits for the displayed time (expectation <span class="math">\(33.33/2 = 16.67\)</span> seconds) and then moves on to the situation in a) for a total expected waiting time of <span class="math">\(16.67 + 8.75 = 25.42\)</span> seconds).</p>
</li>
</ul>
</li>
</ul>
<p>Again we find his total expected waiting time by taking the weighted sum:</p>
<div class="math">$$ \bar t_{\text{wait}} \approx 0.5 \cdot 8.75\ \text{s} + 0.5 \cdot \left(0.58\cdot 40\ \text{s} + 0.42 \cdot 25.42\ \text{s} \right) \approx 21.3\ \text{s}$$</div>
<p>Note that this by-hand calculation has some rounding errors in the cutoff and proportions, but the exact value also rounds to <strong>21.3 seconds</strong>.</p>
<h2>c) Write a code that takes as inputs the number of signals and the number of times Calvin can use his magic wand, and outputs the expected waiting time</h2>
<p>Now we want full generalization to any number of lights and wand uses. It should be clear from the reliance of the calculation in b) on the results from a) that we can use a recursive strategy to calculate the total waiting time.</p>
<p>There are two questions to answer: What should the cutoff be for multiple uses of the wand? And what is the recursive pattern for calculating the expected wait time?</p>
<p>Let's begin with the cutoff. When Calvin comes to a red light, he must decide whether to use the wand or not. For a walk with <span class="math">\(n\)</span> lights, our strategy has been to consider the expected maximum wait encountered during the next <span class="math">\(n-1\)</span> lights. We can generalize by considering the expected maximum wait at the number of remaining lights we expect to wait at, including the current one. If Calvin has <span class="math">\(w\)</span> uses of his wand, then he can skip up to <span class="math">\(w\)</span> lights, meaning he has to wait at <span class="math">\(n-w\)</span> lights in total, including the current one. So the cutoff for using the wand can be generalized to</p>
<div class="math">$$ E_{\tilde{n}} = 80 \cdot \left(1 - \frac{2}{\tilde{n}+1}\left(1-\frac{1}{2^{\tilde{n}+1}}\right)\right),\ \tilde{n} = n - w. $$</div>
<p>This new cutoff is smaller than the previous one when <span class="math">\(w&gt;1\)</span>, which makes sense since we would then like to be more liberal with our wand usage.</p>
<p>Now that we have the cutoff, we need the recursive pattern. Again we have three scenarios. If we have <span class="math">\(n\)</span> lights and <span class="math">\(w\)</span> wands to go, then the scenarios are:</p>
<ul>
<li>
<p>The current light is green (50% chance). In this case the expected waiting time is just the waiting time for <span class="math">\(n-1\)</span> lights and <span class="math">\(w\)</span> wand uses.</p>
</li>
<li>
<p>The current light is red (50% chance):</p>
<ul>
<li>
<p>The waiting time is below the cutoff (probability <span class="math">\(\text{cutoff} / 80\)</span>). In this case Calvin doesn't use the wand, and the total waiting time is the wait at the current light (expectation <span class="math">\(\text{cutoff}/2\)</span>) plus the expected wait at <span class="math">\(n-1\)</span> lights with <span class="math">\(w\)</span> wands.</p>
</li>
<li>
<p>The waiting time is above the cutoff (probability <span class="math">\(1 - \text{cutoff} / 80\)</span>). Now Calvin uses the wand, adding no extra waiting time, so the expected total wait is the expected wait for <span class="math">\(n-1\)</span> lights and <span class="math">\(w-1\)</span> wands.</p>
</li>
</ul>
</li>
</ul>
<p>We calculate these scenarios, recursing whenever we need a new total expected wait time for a different number of lights and/or wands, until we hit one of the base cases. There are a few:</p>
<ul>
<li>
<p>If we have 0 lights to go, then the expected total remaining wait time is 0 seconds.</p>
</li>
<li>
<p>If the number of wands is greater than or equal to the number of lights, then the wait time is 0 seconds (since we can switch all the lights off).</p>
</li>
<li>
<p>If we have no wands left, then the wait time is just the expected wait per light (20 seconds) times the number of lights remaining.</p>
</li>
</ul>
<p>We can write a function to do this calculation:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">wait_time_exp</span><span class="p">(</span><span class="n">n_lights</span><span class="p">,</span> <span class="n">n_wands</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate Calvin&#39;s total expected wait time on his journey home.</span>

<span class="sd">    Args:</span>
<span class="sd">        n_lights (int): The number of lights on the journey</span>
<span class="sd">        n_wands (int): The number of times Calvin can use his wand</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: The total expected time spent waiting at lights</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># maximum time per timer</span>
    <span class="n">counter_max</span> <span class="o">=</span> <span class="mi">80</span>

    <span class="c1">#### Base cases ####</span>
    <span class="c1"># no lights left</span>
    <span class="k">if</span> <span class="n">n_lights</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="c1"># enough wands to switch all lights</span>
    <span class="k">elif</span> <span class="n">n_wands</span> <span class="o">&gt;=</span> <span class="n">n_lights</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="c1"># no wands left</span>
    <span class="k">elif</span> <span class="n">n_wands</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">n_lights</span> <span class="o">*</span> <span class="n">counter_max</span> <span class="o">/</span> <span class="mi">4</span>

    <span class="c1">#### Recursion ####</span>
    <span class="c1"># cutoff for the number of lights we expect to wait at</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">n_lights</span><span class="o">-</span><span class="n">n_wands</span>
    <span class="n">cutoff</span> <span class="o">=</span> <span class="n">counter_max</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">))))</span>

    <span class="c1"># initialize 3 scenarios</span>
    <span class="n">probs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">waits</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

    <span class="c1"># scenario 0: green light</span>
    <span class="n">probs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="n">waits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">wait_time_exp</span><span class="p">(</span><span class="n">n_lights</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_wands</span><span class="p">)</span>

    <span class="c1"># scenario 1: red light + wait</span>
    <span class="n">probs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">cutoff</span><span class="o">/</span><span class="n">counter_max</span>
    <span class="n">waits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">cutoff</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">waits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># scenario 2: red light + use a wand</span>
    <span class="n">probs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">cutoff</span><span class="o">/</span><span class="n">counter_max</span><span class="p">)</span>
    <span class="n">waits</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">wait_time_exp</span><span class="p">(</span><span class="n">n_lights</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_wands</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># return weighted sum of scenarios</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">probs</span><span class="o">*</span><span class="n">waits</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>


<p>And finally we finish off with some art to confirm that the function is behaving as we expect it to.</p>
<div class="highlight"><pre><span></span><span class="c1"># set up variables</span>
<span class="n">n_lights</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">n_wands</span> <span class="o">=</span> <span class="mi">20</span>

<span class="n">lights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_lights</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">wands</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_wands</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># initialize waiting times</span>
<span class="n">times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_lights</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_wands</span><span class="o">+</span><span class="mi">1</span><span class="p">,))</span>

<span class="c1"># calculate waiting times</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">lights</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">wands</span><span class="p">:</span>
        <span class="n">times</span><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="n">w</span><span class="p">]</span> <span class="o">=</span> <span class="n">wait_time_exp</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">w</span><span class="p">)</span>

<span class="c1"># plot the waiting times as a heatmap</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">,))</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">times</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Total expected waiting time on Calvin</span><span class="se">\&#39;</span><span class="s1">s walk home&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Number of lights&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Number of wand uses&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">lights</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">lights</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">wands</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">wands</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Time (seconds)&#39;</span><span class="p">);</span>
</pre></div>


<p><img alt="png" src="/images/calvin_11_0.png"></p>
<p>With the problem thoroughly solved, I can finally sleep at night again.</p>
<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width < 768) ? "left" : align;
        indent = (screen.width < 768) ? "0em" : indent;
        linebreak = (screen.width < 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="https://johnpaton.net/tag/python.html">python</a>
      <a href="https://johnpaton.net/tag/statistics.html">statistics</a>
      <a href="https://johnpaton.net/tag/puzzles.html">puzzles</a>
    </p>
  </div>



    <div class="addthis_relatedposts_inline">


<!-- Disqus -->
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'johnpatonblog';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>
        Please enable JavaScript to view comments.

</noscript>
<!-- End Disqus -->
</article>

    <footer>
<p>&copy; John Paton 2017</p>
<p>    Powered by <a href="http://getpelican.com" target="_blank">Pelican</a> - Theme <a href="https://github.com/JohnPaton/flex-mod" target="_blank">modified</a> from <a href="http://alexandrevicenzi.com" target="_blank">Alexandre Vicenzi</a>'s <a href="https://github.com/alexandrevicenzi/flex" target="_blank">Flex</a>
</p>    </footer>
  </main>

<!-- Google Analytics -->
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-92349567-1', 'auto');
  ga('send', 'pageview');
</script>
<!-- End Google Analytics -->



<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " John Paton ",
  "url" : "https://johnpaton.net",
  "image": "/images/headshot.png",
  "description": "John's deep musings and cheap tricks for Python, data science, machine learning, and more."
}
</script>

</body>
</html>